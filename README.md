# xml-renderer

Combines XML and XPath with _your_ components and stylesheets to render whatever in React or elsewhere. Can be used for
front- or back-end rendering.

## Demonstration

-   [Demonstration site with several documents](https://wvbe.github.io/xml-renderer)
-   [Code to the demonstration site](https://github.com/wvbe/xml-renderer-demo)

## Installation

```sh
npm i xml-renderer --save
```

## Example

Find this example code with annotations in [example.js](./example.js). You can run it in Node using
`npx babel example.js | node`.

```js
import React from 'react';
import { renderToStaticMarkup } from 'react-dom/server';
import { sync } from 'slimdom-sax-parser';

// Take the default export of `xml-renderer`
import MetadataRegistry from 'xml-renderer';

// Instantiate a new object to contain rendering rules
const experience = new MetadataRegistry();

// For text nodes you _probably_ just want to show the text content
experience.add('self::text()', ({ node }) => node.nodeValue);

// For some nodes, including the document node, you _probably_ just want to render the children
experience.add('self::node()', ({ traverse }) => traverse());

// For other nodes you may want to add a template
experience.add('self::paragraph', ({ traverse }) => <p>{traverse()}</p>);

// For some situations you may want to specify a more specific test
experience.add('self::paragraph[not(preceding-sibling::*)]', ({ traverse }) => (
	<p>
		<b>{traverse()}</b>
	</p>
));

// For some situations you may want to traverse into specific children, or add some elements of your own
experience.add('self::webpage', ({ traverse }) => (
	<div>
		<h1>My first page</h1>
		{traverse('./paragraph')}
	</div>
));

// React is not included, so bring your own
const renderer = experience.createReactRenderer(React);

// In this example we're rendering to a string, but this works for "normal" React use too
const rendered = renderToStaticMarkup(
	renderer(
		sync(`
			<webpage>
				<paragraph>Beep boop baap.</paragraph>
				<paragraph>I am a robot.</paragraph>
				<copy>Copyright whomever</copy>
			</webpage>
		`)
	)
);

// Profit
console.log(rendered);
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

-   [MetadataRegistry](#metadataregistry)
    -   [Parameters](#parameters)
    -   [add](#add)
        -   [Parameters](#parameters-1)
    -   [remove](#remove)
        -   [Parameters](#parameters-2)
    -   [find](#find)
        -   [Parameters](#parameters-3)
    -   [createRenderer](#createrenderer)
        -   [Parameters](#parameters-4)
    -   [createReactRenderer](#createreactrenderer)
        -   [Parameters](#parameters-5)
-   [getKeyForNode](#getkeyfornode)
    -   [Parameters](#parameters-6)

### MetadataRegistry

A class that you instantiate to contain "metadata" associated with certain XML nodes. The metadata could be anything,
but in context of being an "xml renderer" you'll probably want to use it for templates or React components. This data
is associated with XML nodes via an XPath test. For any given node, the metadata associated with the closest matching
test is returned.

#### Parameters

-   `sets` **...any** 

#### add

Add a node/metadata associationto the registry.

##### Parameters

-   `test` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** An XPath test that returns TRUE or FALSE given a node
-   `data` **any** The metadata associated with nodes matching the test

#### remove

Remove a node/metadata association from the registry. This is the opposite of the [Metadata.add](Metadata.add) method.

##### Parameters

-   `test` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** An XPath test that returns TRUE or FALSE given a node
-   `data` **any** The metadata associated with nodes matching the test

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** `true` if the metadata was removed, `false` otherwise.

#### find

Retrieve the metadata that was associated with this node before. Gives you only the metadata of the test/data
pair that has the best match. For example `<b>` could match tests self::b`as well as`self::b[not(child::*)]\`,
but the latter is more specific so it wins.

##### Parameters

-   `node` **[Node](https://developer.mozilla.org/docs/Web/API/Node/nextSibling)** The XML node to retrieve associated metadata for.

Returns **any** The metadata associated with this node

#### createRenderer

Creates a function to transform a DOM structure using the `factory` argument function and the test/data pairs
known to this registry instance.

##### Parameters

-   `factory` **function (data: any, {node: [Node](https://developer.mozilla.org/docs/Web/API/Node/nextSibling), traverse: function (query: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)): [Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;any>}): any** The
        visitor function

Returns **function (node: [Node](https://developer.mozilla.org/docs/Web/API/Node/nextSibling)): any** A function to start rendering with

#### createReactRenderer

Creates a function to transform a DOM structure using React, which you have to pass as the only argument so that
`xml-renderer` itself does not have to depend on it.

##### Parameters

-   `React` **React** The React class.

Returns **function (node: [Node](https://developer.mozilla.org/docs/Web/API/Node/nextSibling)): ReactElement** A function to start rendering with

### getKeyForNode

Utility function to generate a unique key for a given node. Is automatically used as the `key` prop in case you're
using {MetadataRegistry.createReactRenderer}, but you may find it useful in other scenarios too.

#### Parameters

-   `node` **[Node](https://developer.mozilla.org/docs/Web/API/Node/nextSibling)** The XML node
-   `identifierAttribute` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** The name of a uniquely identifying attribute. Defaults to `"id"`, set
        to `null` to disable using uniquely identifying attributes in the generated key. (optional, default `DEFAULT_ID_ATTIBUTE`)

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

## MetadataRegistry

A class that you instantiate to contain "metadata" associated with certain XML nodes. The metadata could be anything,
but in context of being an "xml renderer" you'll probably want to use it for templates or React components. This data
is associated with XML nodes via an XPath test. For any given node, the metadata associated with the closest matching
test is returned.

### Parameters

-   `sets` **...any**

### add

Add a node/metadata associationto the registry.

#### Parameters

-   `test` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** An XPath test that returns TRUE or FALSE given a node
-   `data` **any** The metadata associated with nodes matching the test

### remove

Remove a node/metadata association from the registry. This is the opposite of the [Metadata.add](Metadata.add) method.

#### Parameters

-   `test` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** An XPath test that returns TRUE or FALSE given a node
-   `data` **any** The metadata associated with nodes matching the test

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** `true` if the metadata was removed, `false` otherwise.

### find

Retrieve the metadata that was associated with this node before. Gives you only the metadata of the test/data
pair that has the best match. For example `<b>` could match tests self::b`as well as`self::b[not(child::*)]\`,
but the latter is more specific so it wins.

#### Parameters

-   `node` **[Node](https://developer.mozilla.org/docs/Web/API/Node/nextSibling)** The XML node to retrieve associated metadata for.

Returns **any** The metadata associated with this node

### createRenderer

Creates a function to transform a DOM structure using the `factory` argument function and the test/data pairs
known to this registry instance.

#### Parameters

-   `factory` **function (data: any, {node: [Node](https://developer.mozilla.org/docs/Web/API/Node/nextSibling), traverse: function (query: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)): [Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;any>}): any** The
        visitor function

Returns **function (node: [Node](https://developer.mozilla.org/docs/Web/API/Node/nextSibling)): any** A function to start rendering with

### createReactRenderer

Creates a function to transform a DOM structure using React, which you have to pass as the only argument so that
`xml-renderer` itself does not have to depend on it.

#### Parameters

-   `React` **React** The React class.

Returns **function (node: [Node](https://developer.mozilla.org/docs/Web/API/Node/nextSibling)): ReactElement** A function to start rendering with

## getKeyForNode

Utility function to generate a unique key for a given node. Is automatically used as the `key` prop in case you're
using {MetadataRegistry.createReactRenderer}, but you may find it useful in other scenarios too.

### Parameters

-   `node` **[Node](https://developer.mozilla.org/docs/Web/API/Node/nextSibling)** The XML node
-   `identifierAttribute` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** The name of a uniquely identifying attribute. Defaults to `"id"`, set
        to `null` to disable using uniquely identifying attributes in the generated key. (optional, default `DEFAULT_ID_ATTIBUTE`)

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)**
